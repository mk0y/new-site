---
import ChevronDown from "../icons/ChevronDown.astro";
import Search from "../icons/Search.astro";
import X from "../icons/X.astro";
import Menu from "../icons/Menu.astro";
import { getCurrentLang, getCurrentTranslations } from "../utils";
import LanguagePicker from "./LanguagePicker.astro";
const currentLang = getCurrentLang(Astro.url.host);
const i18nData = await getCurrentTranslations(currentLang);
const { isStatic = true, type = "white" } = Astro.props;
---

<header
  id="site-header"
  class:list={[
    "fixed w-full group top-0 z-50 py-4 border-b border-white/20",
    // isStatic ? "fixed" : "relative mb-20",
    type === "black" ? "bg-black" : "bg-transparent",
  ]}
>
  <div class="container mx-auto px-4 md:px-6">
    <nav class="flex items-center justify-between">
      <!-- Logo -->
      <a
        href="/"
        class="flex items-center gap-2 text-2xl font-bold text-white hover:text-primary-1a transition-colors"
      >
        <img
          src={import.meta.env.PUBLIC_LOGO_URL}
          alt={import.meta.env.PUBLIC_SITE_NAME}
          class="h-8"
        />
        <span class="text-2xl font-bold"
          >{import.meta.env.PUBLIC_SITE_NAME}</span
        >
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        <a href="/" class="text-white hover:text-gray-200"
          >{i18nData.common.homePage}</a
        >
        <a href="/services" class="text-white hover:text-gray-200"
          >{i18nData.common.ourServices}</a
        >
        <a href="/success-stories" class="text-white hover:text-gray-200"
          >{i18nData.common.successStories}</a
        >
        <div class="relative submenu-group group">
          <button
            class="flex items-center gap-0.5 text-white hover:text-gray-200"
          >
            Resources
            <ChevronDown
              classes="mt-0.5 transform transition-transform duration-300 ease-in-out group-hover:rotate-180"
            />
          </button>
          <div class="absolute hidden group-hover:block w-48 top-full">
            <div class="h-2 -mt-1"></div>
            <div
              class:list={[
                "submenu backdrop-blur-xl rounded-lg shadow-lg py-2 border border-white/10",
                type === "black" ? "bg-black/80" : "bg-black/20",
              ]}
            >
              <a
                href="/blog"
                class="block px-4 py-2 text-white hover:bg-white/10 transition-colors"
                >Blog</a
              >
              <a
                href="/docs"
                class="block px-4 py-2 text-white hover:bg-white/10 transition-colors"
                >Documentation</a
              >
              <a
                href="/guides"
                class="block px-4 py-2 text-white hover:bg-white/10 transition-colors"
                >Guides</a
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Language and Search Container -->
      <div class="hidden md:flex items-center space-x-4">
        <LanguagePicker currentLang={currentLang} type={type} />

        <!-- Search Component -->
        <div class="relative" id="search-container">
          <button
            class="text-white p-2 hover:text-gray-200 transition-colors"
            id="search-toggle"
          >
            <Search />
          </button>
          <div
            class="absolute right-0 top-full mt-2 hidden"
            id="search-input-container"
          >
            <div
              class="flex items-center bg-white rounded-lg shadow-lg overflow-hidden"
            >
              <input
                type="text"
                placeholder="Search..."
                class="w-64 px-4 py-2 text-gray-800 focus:outline-none"
                id="search-input"
              />
              <button
                class="p-2 text-gray-600 hover:text-gray-800"
                id="search-close"
              >
                <X />
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <button class="md:hidden text-white" id="mobile-menu-button">
        <Menu />
      </button>
    </nav>

    <!-- Mobile Navigation -->
    <div class="md:hidden hidden" id="mobile-menu">
      <div class="pt-4 pb-3 space-y-3">
        <a href="/" class="block text-white hover:text-gray-200">Home Page</a>
        <a href="/services" class="block text-white hover:text-gray-200"
          >Our Services</a
        >
        <a href="/success-stories" class="block text-white hover:text-gray-200"
          >Success Stories</a
        >
        <button
          class="flex items-center gap-1 text-white hover:text-gray-200 w-full justify-between"
          id="mobile-resources-button"
        >
          Resources
          <ChevronDown
            classes="w-4 h-4 transform transition-transform duration-300 ease-in-out group-hover:rotate-180"
          />
        </button>
        <div class="hidden pl-4 space-y-2 mt-2" id="mobile-resources-menu">
          <div
            class="bg-black/20 backdrop-blur-xl rounded-lg border border-white/10 py-2"
          >
            <a
              href="/blog"
              class="block px-4 py-2 text-white hover:bg-white/10 transition-colors"
              >Blog</a
            >
            <a
              href="/docs"
              class="block px-4 py-2 text-white hover:bg-white/10 transition-colors"
              >Documentation</a
            >
            <a
              href="/guides"
              class="block px-4 py-2 text-white hover:bg-white/10 transition-colors"
              >Guides</a
            >
          </div>
        </div>
        <!-- Mobile Search -->
        <div class="relative mt-4">
          <div class="flex items-center bg-white/10 rounded-lg overflow-hidden">
            <input
              type="text"
              placeholder="Search..."
              class="w-full px-4 py-2 bg-transparent text-white placeholder-gray-300 focus:outline-none"
            />
            <button class="p-2 text-white">
              <Search class="w-5 h-5" />
            </button>
          </div>
        </div>
        <!-- Mobile Language Picker -->
        <div class="mt-4">
          <div class="flex justify-center gap-4">
            <a
              href={import.meta.env.PUBLIC_SITE_URL_EN}
              class="flex items-center space-x-2 px-4 py-2 rounded-md bg-black/20 backdrop-blur-xl border border-white/10 hover:bg-white/10 transition-colors"
            >
              <span class="w-6">ðŸ‡¬ðŸ‡§</span>
              <span class="text-white">English</span>
            </a>
            <a
              href={import.meta.env.PUBLIC_SITE_URL_DE}
              class="flex items-center space-x-2 px-4 py-2 rounded-md bg-black/20 backdrop-blur-xl border border-white/10 hover:bg-white/10 transition-colors"
            >
              <span class="w-6">ðŸ‡©ðŸ‡ª</span>
              <span class="text-white">Deutsch</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  const header = document.getElementById("site-header");
  if (header) {
    const headerHeight = header.offsetHeight;
    header.style.height = `${headerHeight}px`;
    // document.body.style.marginTop = `${headerHeight}px`;
    // document.body.style.paddingTop = `${headerHeight}px`;
  }
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileResourcesButton = document.getElementById(
    "mobile-resources-button"
  );
  const mobileResourcesMenu = document.getElementById("mobile-resources-menu");

  // Search functionality
  const searchToggle = document.getElementById("search-toggle");
  const searchContainer = document.getElementById("search-container");
  const searchInputContainer = document.getElementById(
    "search-input-container"
  );
  const searchInput = document.getElementById(
    "search-input"
  ) as HTMLInputElement;
  const searchClose = document.getElementById("search-close");

  // Mobile menu handlers
  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });

  mobileResourcesButton?.addEventListener("click", (e) => {
    const chevron = mobileResourcesButton.querySelector("svg");
    chevron?.classList.toggle("rotate-180");
    mobileResourcesMenu?.classList.toggle("hidden");
  });

  // Handle search toggle with animation
  searchToggle?.addEventListener("click", (e) => {
    e.stopPropagation();
    searchInputContainer?.classList.remove("hidden");
    setTimeout(() => searchInput?.focus(), 100);
  });

  searchClose?.addEventListener("click", (e) => {
    e.stopPropagation();
    if (searchInput) searchInput.value = "";
    searchInputContainer?.classList.add("hidden");
  });

  // Close search on click outside
  document.addEventListener("click", (event) => {
    const target = event.target as HTMLElement;
    if (!searchContainer?.contains(target)) {
      if (searchInput) searchInput.value = "";
      searchInputContainer?.classList.add("hidden");
    }
  });
</script>

<style>
  /* Add backdrop blur when scrolling */
  #site-header {
    position: fixed;
    transition:
      background-color 0.3s ease,
      top 0.3s ease;
    transform: translateY(0);
    z-index: 999;
  }

  #site-header.scrolled {
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(8px);
  }

  /* Resources submenu animation */
  .submenu-group > div {
    opacity: 0;
    visibility: hidden;
    transform: translateY(-5px);
    transition: all 0.2s ease-out;
    pointer-events: none;
  }

  .submenu-group:hover > div {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    pointer-events: auto;
  }

  /* Mobile Resources menu animation */
  #mobile-resources-menu {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    max-height: 0;
    opacity: 0;
    overflow: hidden;
  }

  #mobile-resources-menu:not(.hidden) {
    max-height: 200px;
    opacity: 1;
  }

  /* Enhanced Search animation */
  #search-input-container {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-20px) scale(0.95);
  }

  #search-input-container:not(.hidden) {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }

  /* Language menu animation */
  #language-menu {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
  }

  #language-menu:not(.hidden) {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  /* Search input animation */
  #search-input {
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 200px;
  }

  #search-input:focus {
    width: 300px;
  }

  /* Mobile search animation */
  .mobile-search-enter {
    animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Add backdrop blur to header on scroll
  const header = document.getElementById("site-header");
  window.addEventListener("scroll", () => {
    if (window.scrollY > 50) {
      header?.classList.add("scrolled");
    } else {
      header?.classList.remove("scrolled");
    }
  });
</script>
